<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.spydrone.baraddur.repository.StageEventMapper">

    <resultMap id="stageEventResultMap" type="com.spydrone.baraddur.model.LotStageEvent">
        <constructor>
            <idArg column="event_id"  javaType="String"/>
            <arg   column="lot_id"    javaType="String"/>
            <arg   column="new_stage" javaType="String"/>
        </constructor>
    </resultMap>

    <select id="findUnprocessed" resultMap="stageEventResultMap">
        SELECT event_id, lot_id, new_stage FROM lot_stage_events WHERE processed = FALSE
    </select>

    <update id="markProcessed">
        UPDATE lot_stage_events SET processed = TRUE WHERE event_id = #{eventId}
    </update>

</mapper>
